<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SubPro | لوحة الأداء المالي</title>
    
    <!-- Resource Hints for better performance -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://npmcdn.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    
    <!-- Optimized font loading with font-display: swap -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap"></noscript>
    
    <!-- Optimized CSS -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    
    <!-- Preload critical scripts -->
    <link rel="modulepreload" href="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js">
    <link rel="modulepreload" href="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js">
    <link rel="modulepreload" href="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js">
    
    <!-- Non-critical scripts loaded with defer -->
    <script src="https://cdn.tailwindcss.com" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr" defer></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/ar.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
</head>
<body class="p-4 md:p-8">

    <div id="notification"></div>

    <main class="container">
        <header class="main-card mb-8">
            <div class="p-4 sm:p-6 flex flex-wrap justify-between items-center gap-4 border-b border-b-[var(--border-color)]">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">SubPro Dashboard</h1>
                    <p class="text-gray-500 mt-1">نظرة شاملة على أداء مشروعك المالي.</p>
                </div>
            </div>
            <nav class="flex flex-wrap">
                <button class="nav-tab active" data-tab="dashboard">
                    <i class="fa-solid fa-chart-pie ml-2"></i>الرئيسية
                </button>
                 <button class="nav-tab" data-tab="reports">
                    <i class="fa-solid fa-chart-line ml-2"></i>التقارير
                </button>
                <button class="nav-tab" data-tab="sales">
                    <i class="fa-solid fa-receipt ml-2"></i>سجل المبيعات
                </button>
                <button class="nav-tab" data-tab="renewals">
                    <i class="fa-solid fa-bell ml-2"></i>التنبيهات
                    <span id="renewals-count" class="hidden"></span>
                </button>
                <button class="nav-tab" data-tab="problems">
                    <i class="fa-solid fa-bug ml-2"></i>المشاكل
                </button>
                <button class="nav-tab" data-tab="accounts">
                    <i class="fa-solid fa-users ml-2"></i>إدارة الأكونتات
                </button>
                <button class="nav-tab" data-tab="expenses">
                    <i class="fa-solid fa-file-invoice-dollar ml-2"></i>المصروفات
                </button>
            </nav>
        </header>
        
        <div id="dashboard-section" class="tab-content">
             <div class="main-card p-4 sm:p-6 mb-8 w-full">
                <div class="flex flex-wrap gap-4 items-center justify-center mb-6 pb-6 border-b border-b-[var(--border-color)]">
                    <label class="font-semibold text-gray-700">فلترة حسب التاريخ:</label>
                    <div class="relative">
                        <input type="text" id="date-range-filter" placeholder="اختر يوم أو فترة زمنية..." class="form-input pl-10 text-center cursor-pointer">
                        <i class="fa-solid fa-calendar-days absolute top-1/2 left-3 -translate-y-1/2 text-gray-500 pointer-events-none"></i>
                    </div>
                     <button id="clear-date-filter-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-md transition-colors text-sm">
                         <i class="fa-solid fa-xmark mr-2"></i>مسح
                     </button>
                </div>

                <div id="dashboard-loader" class="text-center text-gray-500 py-10"><p>جاري الاتصال بقاعدة البيانات...</p></div>

                <div id="dashboard-content" class="grid grid-cols-12 gap-6 hidden">
                    <!-- Dashboard cards will be rendered here by JavaScript -->
                </div>
             </div>
        </div>

        <div id="reports-section" class="tab-content hidden space-y-8">
            <div class="main-card p-6">
                <h3 class="text-xl font-bold mb-4 text-gray-800">الأداء المالي الشهري</h3>
                <div class="h-80"><canvas id="monthly-performance-chart"></canvas></div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="main-card p-6 lg:col-span-2">
                    <h3 id="profit-by-product-title" class="text-xl font-bold mb-4 text-gray-800">المنتجات الأكثر ربحية</h3>
                    <div class="h-96"><canvas id="profit-by-product-chart"></canvas></div>
                </div>
                <div class="main-card p-6">
                    <h3 id="expenses-by-type-title" class="text-xl font-bold mb-4 text-gray-800">توزيع المصروفات</h3>
                    <div class="h-96 flex items-center justify-center"><canvas id="expenses-by-type-chart"></canvas></div>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                 <div class="main-card p-6">
                    <h3 id="sales-by-source-title" class="text-xl font-bold mb-4 text-gray-800">تحليل المبيعات حسب المصدر</h3>
                     <div class="h-80 flex items-center justify-center"><canvas id="sales-by-source-chart"></canvas></div>
                 </div>
                 <div class="main-card p-6">
                    <h3 id="trader-analysis-title" class="text-xl font-bold mb-4 text-gray-800">تحليل تكلفة التجار</h3>
                    <div class="h-80"><canvas id="trader-analysis-chart"></canvas></div>
                 </div>
            </div>
        </div>
        
        <div id="sales-section" class="tab-content hidden">
            <div class="main-card p-4 sm:p-6 mb-8 w-full">
                <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                    <h2 class="text-2xl font-bold text-gray-800">سجل المبيعات</h2>
                    <div class="flex gap-2 flex-wrap">
                        <button id="export-sales-btn" class="primary-btn bg-green-600 hover:bg-green-700 text-sm">
                            <i class="fa-solid fa-file-excel ml-2"></i> تصدير البيانات
                        </button>
                        <button id="toggle-add-sale-form" class="primary-btn bg-indigo-600 hover:bg-indigo-700 text-sm">
                            <i class="fa-solid fa-plus ml-2"></i> إضافة أوردر
                        </button>
                    </div>
                </div>

                <div id="add-sale-container" class="collapsible-content">
                    <div class="mt-4 p-4 lg:p-6 bg-slate-50 rounded-lg border border-slate-200">
                        <form id="add-sale-form" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <div>
                                    <label class="block mb-1 text-sm font-medium text-gray-700">بيانات التواصل</label>
                                    <input type="text" id="add-contactInfo" name="contactInfo" class="form-input w-full" required />
                                </div>
                                <div>
                                    <label class="block mb-1 text-sm font-medium text-gray-700">وسيلة التواصل</label>
                                    <select name="contactMethod" class="form-input w-full" required>
                                        <option value="">اختر...</option>
                                        <option value="WhatsApp">WhatsApp</option>
                                        <option value="Facebook">Facebook</option>
                                        <option value="Instagram">Instagram</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mb-1 text-sm font-medium text-gray-700">المنتج</label>
                                    <select name="productName" class="form-input w-full add-productName" required>
                                        <option value="">جار تحميل المنتجات...</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mb-1 text-sm font-medium text-gray-700">نوع الحساب</label>
                                    <select name="accountType" class="form-input w-full" required>
                                        <option value="">اختر...</option>
                                        <option value="Private">برايفت (Private)</option>
                                        <option value="Subscriber">مشترك (Subscriber)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mb-1 text-sm font-medium text-gray-700">مدة الاشتراك</label>
                                    <input list="subscription-list" name="subscription" class="form-input w-full" placeholder="اختر أو اكتب مدة..." required>
                                    <datalist id="subscription-list">
                                        <option value="1 Month"></option>
                                        <option value="3 Months"></option>
                                        <option value="6 Months"></option>
                                        <option value="1 Year"></option>
                                        <option value="Lifetime"></option>
                                    </datalist>
                                </div>
                                <div>
                                    <label class="block mb-1 text-sm font-medium text-gray-700">سعر البيع</label>
                                    <input type="number" step="0.01" name="sellingPrice" class="form-input w-full" required />
                                </div>
                            </div>
                            <div class="pt-4 border-t border-slate-300">
                                <label class="flex items-center space-x-2 space-x-reverse cursor-pointer">
                                    <input type="checkbox" id="manual-sale-checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                    <span class="text-sm font-medium text-gray-700">بيع بدون استخدام أكونت من المخزون</span>
                                </label>
                            </div>
                            <div id="inventory-sale-container">
                                <label class="block mb-1 text-sm font-medium text-gray-700">الأكونت المتاح (من المخزون)</label>
                                <select name="accountId" id="available-accounts-select" class="form-input w-full available-accounts-select" required>
                                    <option value="">اختر الأكونت المتاح</option>
                                </select>
                            </div>
                            <div id="manual-sale-container" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block mb-1 text-sm font-medium text-gray-700">إيميل العميل</label>
                                    <input type="email" id="add-customerEmail" name="customerEmail" class="form-input w-full" />
                                </div>
                                <div>
                                    <label class="block mb-1 text-sm font-medium text-gray-700">تكلفة الشراء (يدوي)</label>
                                    <input type="number" id="add-costPrice" step="0.01" name="costPrice" class="form-input w-full" />
                                </div>
                            </div>
                            <div class="flex justify-center pt-4">
                                <button type="submit" class="primary-btn w-auto bg-indigo-600 hover:bg-indigo-700">إضافة الاوردر</button>
                            </div>
                        </form>
                    </div>
                    <hr class="my-6" />
                </div>
                
                <div id="sales-status-filter-container" class="my-4 flex flex-wrap gap-2 justify-center">
                    <button class="filter-btn active" data-status="all">كل الأوردرات</button>
                    <button class="filter-btn" data-status="unconfirmed">
                        <!-- Count will be inserted here by JS -->
                        <i class="fa-solid fa-hourglass-half mr-1"></i> غير مؤكد
                    </button>
                </div>
                
                <div id="sales-product-filter-container" class="my-4 flex flex-wrap gap-2 justify-center"></div>

                <input type="text" id="search-input" class="form-input w-full mb-4" placeholder="ابحث في الأوردرات..." />

                <div id="bulk-actions-container" class="hidden bg-indigo-50 p-3 rounded-lg mb-4 flex flex-wrap items-center justify-between gap-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="select-all-checkbox" class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 cursor-pointer">
                        <label for="select-all-checkbox" class="mr-2 font-semibold text-indigo-800">تحديد الكل</label>
                    </div>
                    <button id="bulk-confirm-btn" class="primary-btn text-sm py-2 px-4 opacity-50 cursor-not-allowed">
                        تأكيد المحدد
                        <span id="bulk-confirm-count" class="bg-indigo-700 rounded-full px-2 py-0.5 text-xs text-white">0</span>
                    </button>
                </div>
                <div id="sales-list-container">
                    <p class="text-center py-10 text-gray-500">جاري تحميل البيانات...</p>
                </div>
            </div>
        </div>
        
        <div id="renewals-section" class="tab-content hidden">
            <div class="main-card p-4 sm:p-6 w-full">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">تنبيهات تجديد الاشتراك</h2>
                <div id="renewals-list-container">
                    <p class="text-center py-10 text-gray-500">جاري تحميل التنبيهات...</p>
                </div>
            </div>
        </div>

        <div id="problems-section" class="tab-content hidden">
            <div class="main-card p-4 sm:p-6 mb-8 w-full">
                <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                    <h2 class="text-2xl font-bold text-gray-800">سجل المشاكل</h2>
                    <button id="toggle-add-problem-form" class="primary-btn bg-red-600 hover:bg-red-700 text-sm">
                        <i class="fa-solid fa-plus ml-2"></i> الإبلاغ عن مشكلة
                    </button>
                </div>

                <div id="add-problem-container" class="collapsible-content">
                    <div class="mt-4 p-4 lg:p-6 bg-slate-50 rounded-lg border border-slate-200">
                        <form id="add-problem-form" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block mb-1 text-sm font-medium text-gray-700">الأوردر الأصلي</label>
                                    <select id="problem-sale-id" name="saleId" class="form-input w-full" required>
                                        <option value="">اختر الأوردر المرتبط بالمشكلة...</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mb-1 text-sm font-medium text-gray-700">الأكونت البديل</label>
                                    <select id="problem-replacement-account-id" name="replacementAccountId" class="form-input w-full" required>
                                        <option value="">اختر الأكونت البديل...</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block mb-1 text-sm font-medium text-gray-700">تفاصيل المشكلة</label>
                                <textarea name="description" class="form-input w-full h-24" placeholder="مثال: الحساب لا يعمل، تم تغيير كلمة المرور..."></textarea>
                            </div>
                            <div class="flex justify-center pt-4">
                                <button type="submit" class="primary-btn w-auto bg-red-600 hover:bg-red-700">إضافة المشكلة</button>
                            </div>
                        </form>
                    </div>
                    <hr class="my-6" />
                </div>
                
                <div id="problems-list-container">
                    <p class="text-center py-10 text-gray-500">جاري تحميل البيانات...</p>
                </div>
            </div>
        </div>

        <div id="accounts-section" class="tab-content hidden">
             <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 main-card p-4 sm:p-6 w-full">
                     <div class="flex justify-between items-center mb-4 flex-wrap gap-2">
                        <h2 class="text-2xl font-bold text-gray-800">إدارة الأكونتات</h2>
                        <button id="toggle-add-account-form" class="primary-btn">
                                <i class="fa-solid fa-plus mr-2"></i> إضافة أكونت
                        </button>
                     </div>
                     <div id="add-account-container" class="collapsible-content">
                             <div class="mt-4 p-4 lg:p-6 bg-slate-50 rounded-lg border border-slate-200">
                                <form id="add-account-form">
                                      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-x-6 gap-y-4">
                                             <div class="md:col-span-2 lg:col-span-4">
                                                  <label for="emails-textarea" class="block text-sm font-medium text-gray-700 mb-1">الإيميلات والباسوردات (كل زوج في سطر بصيغة email:password)</label>
                                                  <textarea name="emails" class="form-input w-full" placeholder="example@email.com:password123" required rows="4"></textarea>
                                             </div>
                                             <div>
                                                  <label class="block mb-1 text-sm font-medium text-gray-700">المنتج</label>
                                                  <select name="productName" class="form-input w-full add-account-productName" required><option value="">جار تحميل المنتجات...</option></select>
                                             </div>
                                             <div>
                                                  <label class="block mb-1 text-sm font-medium text-gray-700">سعر الشراء</label>
                                                  <input type="number" step="0.01" name="purchase_price" class="form-input w-full" required />
                                             </div>
                                             <div>
                                                  <label class="block mb-1 text-sm font-medium text-gray-700">اسم التاجر</label>
                                                  <input type="text" name="trader_name" class="form-input w-full" required />
                                             </div>
                                             <div>
                                                  <label class="block mb-1 text-sm font-medium text-gray-700">عدد الاستخدامات</label>
                                                  <div class="flex items-center space-x-2 space-x-reverse bg-white p-0 border border-gray-300 rounded-md focus-within:ring-2 focus-within:ring-indigo-500 focus-within:border-indigo-500">
                                                       <input type="number" name="allowed_uses" class="p-2 border-none w-full focus:ring-0" min="1" required />
                                                       <div class="flex items-center flex-shrink-0 pr-2 border-r border-gray-300">
                                                            <input type="checkbox" id="lifetime-checkbox" name="is_lifetime" class="h-4 w-4 text-sky-600 border-gray-300 rounded focus:ring-sky-500">
                                                            <label for="lifetime-checkbox" class="mr-2 text-sm text-gray-900">للأبد</label>
                                                       </div>
                                                  </div>
                                             </div>
                                       </div>
                                       <div class="flex justify-center mt-6"><button type="submit" class="primary-btn w-auto">إضافة الأكونتات</button></div>
                                 </form>
                             </div>
                             <hr class="my-6" />
                     </div>

                     <div id="accounts-product-filter-container" class="my-4 flex flex-wrap gap-2 justify-center"></div>

                     <input type="text" id="search-accounts-input" class="form-input w-full mb-4" placeholder="ابحث في الأكونتات بالإيميل أو اسم التاجر..." />
                     <div class="overflow-x-auto table-container">
                        <table id="accounts-table" class="min-w-full responsive-table"></table>
                     </div>
                </div>

                <div class="lg:col-span-1 main-card p-4 sm:p-6 w-full h-fit">
                     <h2 class="text-2xl font-bold text-gray-800 mb-4">إدارة المنتجات</h2>
                     <form id="add-product-form" class="flex items-center gap-2 mb-4">
                              <input type="text" name="productName" placeholder="اكتب اسم المنتج الجديد..." class="form-input w-full" required>
                              <button type="submit" class="primary-btn flex-shrink-0"><i class="fa-solid fa-plus"></i></button>
                     </form>
                     <div id="product-list" class="space-y-2 max-h-96 overflow-y-auto"></div>
                </div>
             </div>
        </div>

        <div id="expenses-section" class="tab-content hidden">
            <div class="main-card p-4 sm:p-6 mb-8 w-full">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">سجل المصروفات</h2>
                     <button id="toggle-add-expense-form" class="primary-btn bg-red-600 hover:bg-red-700">
                         <i class="fa-solid fa-plus mr-2"></i> إضافة مصروف
                     </button>
                </div>
                <div id="add-expense-container" class="collapsible-content">
                    <div class="mt-4 p-4 lg:p-6 bg-slate-50 rounded-lg border border-slate-200">
                             <form id="add-expense-form">
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4">
                                     <div>
                                          <label class="block mb-1 text-sm font-medium text-gray-700">نوع المصروف</label>
                                          <select name="type" class="form-input w-full" required><option value="">اختر..</option><option value="إعلان">إعلان</option><option value="اشتراكات تطبيقات">اشتراكات تطبيقات</option><option value="مصاريف أخرى">مصاريف أخرى</option></select>
                                     </div>
                                     <div>
                                          <label class="block mb-1 text-sm font-medium text-gray-700">المبلغ</label>
                                          <input type="number" step="0.01" name="amount" class="form-input w-full" required />
                                     </div>
                                     <div class="sm:col-span-2">
                                          <label class="block mb-1 text-sm font-medium text-gray-700">الوصف (اختياري)</label>
                                          <input type="text" name="description" class="form-input w-full" />
                                     </div>
                                </div>
                                <div class="flex justify-center mt-6"><button type="submit" class="primary-btn bg-red-600 hover:bg-red-700 w-auto">إضافة المصروف</button></div>
                             </form>
                    </div>
                     <hr class="my-6" />
                </div>
                <div class="overflow-x-auto table-container">
                    <table id="expenses-table" class="min-w-full responsive-table"></table>
                </div>
            </div>
        </div>

        <!-- MODALS -->
        <div id="edit-modal-backdrop" class="hidden"></div>
        <div id="edit-modal" class="bg-white main-card p-6 hidden">
             <h3 class="text-xl font-bold mb-4">تعديل الأوردر</h3>
             <form id="edit-sale-form">
                   <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                         <input type="text" name="contactInfo" id="edit-contactInfo" class="form-input w-full" placeholder="بيانات التواصل" required />
                         <select name="contactMethod" id="edit-contactMethod" class="form-input w-full" required><option value="">وسيلة التواصل</option><option value="WhatsApp">WhatsApp</option><option value="Facebook">Facebook</option><option value="Instagram">Instagram</option></select>
                         <select name="productName" id="edit-productName" class="form-input w-full" required> </select>
                         <select name="accountType" id="edit-accountType" class="form-input w-full" required>
                                 <option value="">نوع الحساب</option>
                                 <option value="Private">برايفت (Private)</option>
                                 <option value="Subscriber">مشترك (Subscriber)</option>
                         </select>
                         <div>
                            <label class="block mb-1 text-sm font-medium text-gray-700">مدة الاشتراك</label>
                            <input list="subscription-list" name="subscription" id="edit-subscription" class="form-input w-full" required>
                         </div>
                         <input type="number" step="0.01" name="sellingPrice" id="edit-sellingPrice" class="form-input w-full" placeholder="سعر البيع" required />
                         <div id="edit-cost-price-container">
                            <label class="block mb-1 text-sm font-medium text-gray-700">التكلفة</label>
                            <input type="number" step="0.01" name="costPrice" id="edit-costPrice" class="form-input w-full" required/>
                         </div>
                         <div class="md:col-span-2" id="edit-account-container">
                                 <label class="block text-sm font-medium text-gray-700">تغيير الأكونت (إيميل الاشتراك)</label>
                                 <select name="accountId" id="edit-available-accounts-select" class="form-input w-full"></select>
                         </div>
                   </div>
                   <input type="hidden" id="edit-sale-id" name="id">
                   <input type="hidden" id="edit-original-accountId">
                   <div class="flex justify-end gap-4 mt-6">
                         <button type="button" id="cancel-edit-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-md">إلغاء</button>
                         <button type="submit" class="primary-btn">حفظ التعديلات</button>
                   </div>
             </form>
        </div>
        <div id="edit-account-modal-backdrop" class="hidden"></div>
        <div id="edit-account-modal" class="bg-white main-card p-6 hidden">
             <h3 class="text-xl font-bold mb-4">تعديل الأكونت</h3>
             <form id="edit-account-form">
                   <input type="hidden" id="edit-account-id">
                   <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                         <input type="email" id="edit-account-email" class="form-input" placeholder="البريد الإلكتروني" required />
                         <input type="text" id="edit-account-password" class="form-input" placeholder="الباسورد" />
                         <select id="edit-account-productName" class="form-input" required> </select>
                         <input type="number" step="0.01" id="edit-account-purchase_price" class="form-input" placeholder="سعر الشراء" required />
                         <input type="text" id="edit-account-trader_name" class="form-input" placeholder="اسم التاجر" required />
                         <input type="number" step="1" id="edit-account-allowed_uses" class="form-input" placeholder="الاستخدام المسموح" min="0" required />
                         <input type="number" step="1" id="edit-account-current_uses" class="form-input" placeholder="الاستخدام الحالي" min="0" required />
                         <div class="md:col-span-2 flex items-center">
                                 <input type="checkbox" id="edit-account-is_active" class="h-4 w-4 text-sky-600 border-gray-300 rounded focus:ring-sky-500">
                                 <label for="edit-account-is_active" class="mr-2 text-sm font-medium text-gray-900">الحساب نشط (غير مكتمل)</label>
                         </div>
                   </div>
                   <div class="flex justify-end gap-4 mt-6">
                                 <button type="button" id="cancel-edit-account-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-md">إلغاء</button>
                                 <button type="submit" class="primary-btn">حفظ التعديلات</button>
                   </div>
             </form>
        </div>
        <div id="edit-expense-modal-backdrop" class="hidden"></div>
        <div id="edit-expense-modal" class="bg-white main-card p-6 hidden">
             <h3 class="text-xl font-bold mb-4">تعديل المصروف</h3>
             <form id="edit-expense-form">
                   <input type="hidden" id="edit-expense-id">
                   <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4">
                         <div>
                                 <label class="block mb-1 text-sm font-medium text-gray-700">نوع المصروف</label>
                                 <select id="edit-expense-type" name="type" class="form-input w-full" required><option value="">اختر..</option><option value="إعلان">إعلان</option><option value="اشتراكات تطبيقات">اشتراكات تطبيقات</option><option value="مصاريف أخرى">مصاريف أخرى</option></select>
                         </div>
                         <div>
                                 <label class="block mb-1 text-sm font-medium text-gray-700">المبلغ</label>
                                 <input type="number" step="0.01" id="edit-expense-amount" name="amount" class="form-input w-full" required />
                         </div>
                         <div class="sm:col-span-2">
                                 <label class="block mb-1 text-sm font-medium text-gray-700">الوصف (اختياري)</label>
                                 <input type="text" id="edit-expense-description" name="description" class="form-input w-full" />
                         </div>
                   </div>
                   <div class="flex justify-end gap-4 mt-6">
                                 <button type="button" id="cancel-edit-expense-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-md">إلغاء</button>
                                 <button type="submit" class="primary-btn">حفظ التعديلات</button>
                   </div>
             </form>
        </div>
        <div id="problem-modal-backdrop" class="hidden"></div>
        <div id="problem-modal" class="bg-white main-card p-6 hidden">
             <h3 class="text-xl font-bold mb-4">تفاصيل المشكلة</h3>
             <div id="problem-details-content"></div>
             <div class="flex justify-end gap-4 mt-6">
                   <button type="button" id="close-problem-modal-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-md">إغلاق</button>
             </div>
        </div>
    </main>

    <!-- Load application JavaScript as a module -->
    <script type="module" src="app.js"></script>
</body>
</html>
